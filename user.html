<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Eagle Flight – Rider</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>Eagle Flight – Rider</h1>

<div class="card">
    <h2>Request a Ride</h2>

    <label>Your Name:</label>
    <input id="riderName" placeholder="John">

    <label>Pickup Address:</label>
    <input id="pickup" placeholder="UNT Union, Eagle Landing, Apogee Stadium">

    <label>Dropoff Address:</label>
    <input id="dropoff" placeholder="Discovery Park, Willis Library">

    <button onclick="requestRide()">Request Ride</button>

    <p id="rideOutput"></p>
    <button id="finishBtn" style="display:none;" onclick="finishRide()">Finish Ride</button>
</div>

<script>
let rideId = null;

function requestRide() {
    const name = document.getElementById("riderName").value;
    const pickup = document.getElementById("pickup").value;
    const dropoff = document.getElementById("dropoff").value;

    fetch("http://127.0.0.1:5000/api/request_ride", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({rider_name: name, pickup, dropoff})
    })
    .then(r => r.json())
    .then(data => {
        rideId = data.ride_id;
        document.getElementById("rideOutput").innerText =
            "Ride Requested! Ride ID: " + rideId;

        pollRideStatus();
    });
}

function pollRideStatus() {
    if (!rideId) return;

    setInterval(() => {
        fetch(`http://127.0.0.1:5000/api/ride_status/${rideId}`)
            .then(r => r.json())
            .then(data => {
                document.getElementById("rideOutput").innerText =
                    "Ride Status: " + data.status +
                    (data.driver_id ? " | Driver: " + data.driver_id : "");

                // Show finish button only if ride is accepted
                if (data.status === "accepted") {
                    document.getElementById("finishBtn").style.display = "inline-block";
                } else {
                    document.getElementById("finishBtn").style.display = "none";
                }

                // Hide button when ride is completed
                if (data.status === "completed") {
                    document.getElementById("finishBtn").style.display = "none";
                    document.getElementById("rideOutput").innerText = "Ride Completed!";
                }
            });
    }, 3000);
}

function finishRide() {
    if (!rideId) return;

    fetch("http://127.0.0.1:5000/api/finish_ride", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ride_id: rideId})
    }).then(() => {
        document.getElementById("rideOutput").innerText = "Ride Completed!";
        document.getElementById("finishBtn").style.display = "none";
    });
}
</script>

</body>
</html>
